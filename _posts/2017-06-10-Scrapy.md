---
layout: post
title:  "爬虫－Scrapy"
date:   2017-06-10 12:17:20 
categories: Scrapy
tags: 爬虫 Scrapy Url管理器 下载器 解析器
author: CLH
---

* content
{:toc}

#Scrapy#

----------

自动抓取互联网上信息的程序，有效地利用互联网上的数据；简单爬虫架构如下：
![](http://i.imgur.com/mLL3ZiG.jpg)


- Url管理器是为了防止重复抓取和循环抓取，其实现方式有三种：内存（Python内存，set()方法）、关系型数据库（MySQL, urls(url,is_crawled)、缓存数据库（redis）。
- 网页下载器，将Url对应的网页下载到本地，存储成本地文件或内存字符串，Python的文件下载器有：urllib2（Python基础模块）、requests（第三方包）：

	下载网页的方法：
	
方法一：

    import urllib2
    response = urllib2.urlopen('http://www.baidu.com')
    print response.getcode() 	#返回200表示获取成功
	cont = response.read()		#读取内容

方法二：

	import urllib2
	request = urllib2.Request(url)		#创建Requset对象
	request.add_data('a','1')			#添加数据
	request.add_header('User-Agent','Mozilla/5.0')	#添加http的header
	response = urllib2.urlopen(request)	#发送请求获取结果

特殊情景的处理器

	HTTPCookieProcessor ProxyHandler HTTPSHandler HTTPRedirectHandler
	opener = urllib2.build_opener(handler)
	urllib2.install_opener(opener)
	urllib2.urlopen(url)
	urllib2.urlopen(request)

	import urllib2,cookielib
	cj = cookielib.CookieJar()	#创建cookie容器
	opener = urllib2.build_opener(urllib2,HTTPCookieProcessor(cj))	#创建一个opener
	urllib2.install_opener(opener)	#给urllib2安装opener
	response = urllib2.urlopen("http://www.baidu.com/")	#使用带有cookie的urllib2访问网页

三种方法的测试

    import urllib2,cookielib
    
    url = "http://www.baidu.com"
    print "第一种方法"
    response1 = urllib2.urlopen(url)
    print response1.getcode()
    print len(response1.read())
    
    print "第二种方法"
    request = urllib2.Request(url)
    request.add_header('user-agent','Mozilla/5.0')
    response2 = urllib2.urlopen(request)
    print response2.getcode()
    print len(response2.read())
    
    print "第三种方法"
    cj = cookielib.CookieJar()
    opener = urllib2.build_opener(urllib2.HTTPCookieProcessor(cj))
    urllib2.install_opener(opener)
    response3 = urllib2.urlopen(url)
    print response3.getcode()
    print cj
    print response3.read()

结果如下：
![](http://i.imgur.com/YikSBQG.jpg)
----------
